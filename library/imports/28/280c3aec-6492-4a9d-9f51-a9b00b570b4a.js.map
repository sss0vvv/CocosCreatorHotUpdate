{"version":3,"sources":["assets/Script/HelloWorld.js"],"names":["window","_Gloabal","Client_Version","JS_LOG","arg","cc","log","Class","Component","properties","ModuleMagPreFab","Prefab","moduleLayer","Node","msgLayer","onLoad","jsb","fileUtils","getWritablePath","_G_AppCom","_AppCom","getComponent","moduleMagObj","instantiate","parent","_G_moduleMag","initCom","execUnpackage","reqVersionInfo","reloadLobbyRoot","reqLoopVersionInfo","loadAb","hotUpdateMultiModule","addModule","moduleObj","abObj","getABObj","load","err","prefab","JSON","stringify","_lobbyRootNode","destroy","lobbyRoot","addChild","initModule"],"mappings":";;;;;;AAEAA,MAAM,CAACC,QAAP,GAAkB;AACdC,EAAAA,cAAc,EAAG,OADH,CACa;;AADb,CAAlB;;AAIA,IAAIC,MAAM,GAAG,SAATA,MAAS,GAAgB;AAAA;;AAAA,oCAAJC,GAAI;AAAJA,IAAAA,GAAI;AAAA;;AACzB,SAAAC,EAAE,EAACC,GAAH,aAAO,cAAP,SAAyBF,GAAzB;AACH,CAFD;;AAKAC,EAAE,CAACE,KAAH,CAAS;AACL,aAASF,EAAE,CAACG,SADP;AAELC,EAAAA,UAAU,EAAE;AACRC,IAAAA,eAAe,EAAGL,EAAE,CAACM,MADb;AAGRC,IAAAA,WAAW,EAAGP,EAAE,CAACQ,IAHT;AAIRC,IAAAA,QAAQ,EAAGT,EAAE,CAACQ;AAJN,GAFP;AAULE,EAAAA,MAAM,EAAE,kBAAY;AAAA;;AAEhBZ,IAAAA,MAAM,CAAC,gBAAD,EAAmBa,GAAG,CAACC,SAAJ,CAAcC,eAAd,EAAnB,CAAN;AAEAlB,IAAAA,MAAM,CAACmB,SAAP,GAAmB,KAAKC,OAAL,GAAe,KAAKC,YAAL,CAAkB,QAAlB,CAAlC,CAJgB,CAOhB;AACA;;AACA,QAAIC,YAAY,GAAMjB,EAAE,CAACkB,WAAH,CAAe,KAAKb,eAApB,CAAtB;AACAY,IAAAA,YAAY,CAACE,MAAb,GAAsB,KAAKV,QAA3B;AACAd,IAAAA,MAAM,CAACyB,YAAP,GAAsBH,YAAY,CAACD,YAAb,CAA0B,eAA1B,CAAtB;;AACAI,IAAAA,YAAY,CAACC,OAAb,CAAqB,CACjB;AADiB,KAArB,EAZgB,CAgBhB;AAEA;;;AACAD,IAAAA,YAAY,CAACE,aAAb,CAA2B,YAAI;AAE3BF,MAAAA,YAAY,CAACG,cAAb,CAA4B,YAAI;AAAE;AAC9B,QAAA,KAAI,CAACC,eAAL;AACH,OAFD;AAGH,KALD,EAnBgB,CA0BhB;;;AACAJ,IAAAA,YAAY,CAACK,kBAAb;AAEH,GAvCI;AAyCLD,EAAAA,eAzCK,6BAyCY;AAAA;;AAEb,QAAIE,MAAM,GAAG,CAAC,SAAD,CAAb,CAFa,CAGb;;AACAN,IAAAA,YAAY,CAACO,oBAAb,CAAkCD,MAAlC,EAAyC,YAAI;AAAE;AAE3CN,MAAAA,YAAY,CAACQ,SAAb,CAAuB,SAAvB,EAAkC,UAACC,SAAD,EAAa;AAAE;AAE7C,YAAIC,KAAK,GAAGD,SAAS,CAACE,QAAV,EAAZ;AAEAD,QAAAA,KAAK,CAACE,IAAN,CAAW,sBAAX,EAAmChC,EAAE,CAACM,MAAtC,EAA8C,UAAC2B,GAAD,EAAMC,MAAN,EAAe;AAAG;AAE5DpC,UAAAA,MAAM,CAAC,qBAAD,EAAwBqC,IAAI,CAACC,SAAL,CAAeH,GAAf,CAAxB,CAAN;;AACA,cAAG,MAAI,CAACI,cAAR,EAAuB;AACnB,YAAA,MAAI,CAACA,cAAL,CAAoBC,OAApB;AACH;;AACD,cAAIC,SAAS,GAAGvC,EAAE,CAACkB,WAAH,CAAegB,MAAf,CAAhB;AACA,UAAA,MAAI,CAACG,cAAL,GAAsBE,SAAtB;;AACA,UAAA,MAAI,CAAChC,WAAL,CAAiBiC,QAAjB,CAA0BD,SAA1B,EAAqC,GAArC;;AACAA,UAAAA,SAAS,CAACvB,YAAV,CAAuB,WAAvB,EAAoCyB,UAApC;AAEH,SAXD;AAYH,OAhBD;AAiBH,KAnBD;AAoBH;AAjEI,CAAT","sourceRoot":"/","sourcesContent":["\n\nwindow._Gloabal = { \n    Client_Version : \"1.0.0\" , //客户端大版本\n}\n\nlet JS_LOG = function(...arg){ \n    cc.log(\"[HelloWorld]\",...arg) ; \n}\n\n\ncc.Class({\n    extends: cc.Component, \n    properties: {\n        ModuleMagPreFab : cc.Prefab ,\n\n        moduleLayer : cc.Node , \n        msgLayer : cc.Node ,\n\n    },\n\n    onLoad: function () {  \n\n        JS_LOG(\"jsb_writable_:\", jsb.fileUtils.getWritablePath() )\n\n        window._G_AppCom = this._AppCom = this.getComponent(\"AppCom\")\n\n\n        // 配置热更新地址到 ModuleConst.js\n        // 初始化\n        let moduleMagObj    = cc.instantiate(this.ModuleMagPreFab)\n        moduleMagObj.parent = this.msgLayer  \n        window._G_moduleMag = moduleMagObj.getComponent(\"ModuleManager\")  \n        _G_moduleMag.initCom({\n            // useHotUpdate : true ,     // 是否启用热更新 \n        }) \n        \n        //-------------------\n\n        // 复制包内模块到可读写路径下,避免首次加载模块时从远程完整拉取\n        _G_moduleMag.execUnpackage(()=>{\n\n            _G_moduleMag.reqVersionInfo(()=>{ // 获取最新版本\n                this.reloadLobbyRoot()\n            })\n        })\n\n        // 定时检测更新\n        _G_moduleMag.reqLoopVersionInfo() \n\n    },\n\n    reloadLobbyRoot(){\n\n        let loadAb = [\"ABLobby\"]\n        // loadAb = [\"ABLobby\", \"ABSubGame1\", \"ABSubGame2\"]\n        _G_moduleMag.hotUpdateMultiModule(loadAb,()=>{ // 更新模块到最新版本\n\n            _G_moduleMag.addModule(\"ABLobby\", (moduleObj)=>{ // 加载模块\n\n                let abObj = moduleObj.getABObj()\n                \n                abObj.load('root/Scene/LobbyRoot', cc.Prefab, (err, prefab)=>{  // 使用模块资源 \n\n                    JS_LOG(\"load_lobby_prefab_:\", JSON.stringify(err) )\n                    if(this._lobbyRootNode){\n                        this._lobbyRootNode.destroy()\n                    }\n                    let lobbyRoot = cc.instantiate(prefab) \n                    this._lobbyRootNode = lobbyRoot\n                    this.moduleLayer.addChild(lobbyRoot, 100)\n                    lobbyRoot.getComponent(\"LobbyRoot\").initModule()    \n    \n                }) \n            })\n        })\n    },\n\n});\n"]}
{"version":3,"sources":["assets/Script/HelloWorld.js"],"names":["window","_Gloabal","Client_Version","JS_LOG","arg","cc","log","Class","Component","properties","ModuleMagPreFab","Prefab","moduleLayer","Node","msgLayer","onDestroy","systemEvent","off","SystemEvent","EventType","KEY_UP","onKeyUp","onLoad","on","hackSysLog","jsb","fileUtils","getWritablePath","_G_AppCom","_AppCom","getComponent","moduleMagObj","instantiate","parent","_G_moduleMag","initCom","useHotUpdate","execUnpackage","reqVersionInfo","reloadLobbyRoot","reqLoopVersionInfo","loadAb","hotUpdateMultiModule","addModule","moduleObj","abObj","getABObj","load","err","prefab","JSON","stringify","_lobbyRootNode","destroy","lobbyRoot","addChild","initModule","event","sys","os","OS_WINDOWS","keyCode","hackSys_Log_Save","_logArr","totalLen","length","reportCo","beginIdx","arrTemp","i","push","retMsg","join","path","getDefaultResourceRootPath","writeStringToFile","_initHackLog","MAX_STR_LEN","excludeStr","push_log","ignore","logStr","strLen","idx","endIdx","splitStr","slice","excStr","indexOf","logDef","_sv_log_2_Ori","call","consoleLogDef","_sv_console_2_logOri","console"],"mappings":"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","sourceRoot":"/","sourcesContent":["\n\nwindow._Gloabal = { \n    Client_Version : \"1.0.0\" , //客户端大版本\n}\n\nlet JS_LOG = function(...arg){ \n    cc.log(\"[HelloWorld]\",...arg) ; \n}\n\n\ncc.Class({\n    extends: cc.Component, \n    properties: {\n        ModuleMagPreFab : cc.Prefab ,\n\n        moduleLayer : cc.Node , \n        msgLayer : cc.Node ,\n\n    },\n\n    onDestroy () { \n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    },\n    onLoad: function () {  \n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n        this.hackSysLog()\n        JS_LOG(\"jsb_writable_:\", jsb.fileUtils.getWritablePath() )\n\n        window._G_AppCom = this._AppCom = this.getComponent(\"AppCom\")\n\n\n        // 配置热更新地址到 ModuleConst.js\n        // 初始化\n        let moduleMagObj    = cc.instantiate(this.ModuleMagPreFab)\n        moduleMagObj.parent = this.msgLayer  \n        window._G_moduleMag = moduleMagObj.getComponent(\"ModuleManager\")  \n        _G_moduleMag.initCom({\n            useHotUpdate : true ,     // 是否启用热更新 \n        }) \n        \n        //-------------------\n\n        // 复制包内模块到可读写路径下,避免首次加载模块时从远程完整拉取\n        _G_moduleMag.execUnpackage(()=>{\n\n            _G_moduleMag.reqVersionInfo(()=>{ // 获取最新版本\n                this.reloadLobbyRoot()\n            })\n        })\n\n        // 定时检测更新\n        _G_moduleMag.reqLoopVersionInfo() \n\n    },\n\n    reloadLobbyRoot(){\n\n        let loadAb = [\"ABLobby\"]\n        // loadAb = [\"ABLobby\", \"ABSubGame1\", \"ABSubGame2\"]\n        _G_moduleMag.hotUpdateMultiModule(loadAb,()=>{ // 更新模块到最新版本\n\n            _G_moduleMag.addModule(\"ABLobby\", (moduleObj)=>{ // 加载模块\n\n                let abObj = moduleObj.getABObj()\n                \n                abObj.load('root/Scene/LobbyRoot', cc.Prefab, (err, prefab)=>{  // 使用模块资源 \n\n                    JS_LOG(\"load_lobby_prefab_:\", JSON.stringify(err) )\n                    if(this._lobbyRootNode){\n                        this._lobbyRootNode.destroy()\n                    }\n                    let lobbyRoot = cc.instantiate(prefab) \n                    this._lobbyRootNode = lobbyRoot\n                    this.moduleLayer.addChild(lobbyRoot, 100)\n                    lobbyRoot.getComponent(\"LobbyRoot\").initModule()    \n    \n                }) \n            })\n        })\n    },\n\n\n\n    onKeyUp(event) { \n        // 9 -- TAB  \n        if(cc.sys.os==cc.sys.OS_WINDOWS && event.keyCode==9){\n            this.hackSys_Log_Save()\n        } \n    },\n    hackSys_Log_Save(){\n        if(!this._logArr){ return ; };\n\n        let totalLen = this._logArr.length\n        let reportCo = 2000\n        let beginIdx = totalLen-reportCo\n        beginIdx = beginIdx>=0?beginIdx:0\n        let arrTemp = []\n\n        for(let i=beginIdx; i<totalLen; i++){\n            arrTemp.push(this._logArr[i])\n        }\n\n        let retMsg = arrTemp.join(\"\\n\")\n        if(typeof jsb!=\"undefined\"){\n            let path = jsb.fileUtils.getDefaultResourceRootPath()\n            if(!path){\n                path = jsb.fileUtils.getWritablePath()\n            }\n            \n            jsb.fileUtils.writeStringToFile(retMsg, path + \"alogRecord.txt\")\n        }\n    },\n    hackSysLog(){\n\n        if(this._initHackLog){ return ; } ; this._initHackLog = true ; \n        let _logArr = []\n        this._logArr = _logArr \n        let MAX_STR_LEN = 1300 \n        let excludeStr = { [\"Can't find letter definition in texture\"]:1 } \n        let push_log = function(...arg){  \n            let ignore = false\n            let logStr = arg.join(\" \")\n            let strLen = logStr.length\n            for(let idx = 0;idx<strLen;){\n                let endIdx = idx+MAX_STR_LEN\n\n                let splitStr = logStr.slice(idx, endIdx)\n                for(let excStr in  excludeStr){\n                    if( splitStr.indexOf(excStr, 0) == 0 ){\n                        ignore = true \n                        break \n                    }\n                }\n                if( !ignore ){\n                    _logArr.push(\"_\"+_logArr.length+\"_=> \"+ splitStr +(endIdx<strLen?\"-->\":\"\")) \n                } \n\n                idx = endIdx\n            } \n            return ignore\n        } \n        let logDef = function(...arg){ \n            let ignore = push_log(...arg)\n            if(!ignore){\n                cc._sv_log_2_Ori.call(cc, ...arg)\n            }\n        }\n        let consoleLogDef = function(...arg){ \n            let ignore = push_log(...arg) \n            if(!ignore){\n                if(cc._sv_console_2_logOri) { cc._sv_console_2_logOri.call(console,...arg ) }\n            } \n        }\n        if(!cc._sv_log_2_Ori){ cc._sv_log_2_Ori = cc.log  }\n        if(!cc._sv_console_2_logOri){ cc._sv_console_2_logOri = console.log  }\n        cc.log      = logDef\n        console.log = consoleLogDef\n    },\n\n\n});\n"]}
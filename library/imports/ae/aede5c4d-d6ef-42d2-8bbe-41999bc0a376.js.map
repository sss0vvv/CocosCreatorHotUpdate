{"version":3,"sources":["assets/Script/ModuleMag/ModuleCom.js"],"names":["cc","Class","Component","properties","makeXMLHttp","args","timeout","url","callback","retInfo","isValid","xhr","XMLHttpRequest","Math","ceil","onreadystatechange","readyState","status","httpDatas","JSON","parse","responseText","retData","fail","open","setRequestHeader","send","ontimeout","isTimeout","abort","parallelMis","co","ret","retArgs","onFinish","Object","assign","addMis","start","close","sequenceMis","misArr","onAllExec","execFunc","log","execMis","length","mis","curCo","comVersion","localVer","romoteVer","verSplit_local","split","verSplit_remote","localCo","remoteCo","maxCo","i","n_local","parseInt","n_remote","createUUID","chars","uuid","random","uid","join","Number","Date","now","toString"],"mappings":"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","sourceRoot":"/","sourcesContent":["\n// let ModuleCom = require(\"ModuleCom\")\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n\n    },\n\n    // makeXMLHttp({url: , callback:(retInfo)=>{}})\n    makeXMLHttp(args){\n\n        let {timeout, url, callback} = args\n        let retInfo = {}\n\n        let isValid = true\n        let xhr = new XMLHttpRequest();\n        xhr.timeout = Math.ceil((timeout || 6)*1000);\n        xhr.onreadystatechange = function () { \n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\n                if(!isValid){ return } ; isValid = false \n                var httpDatas = JSON.parse(xhr.responseText); \n                callback({retData:httpDatas})\n            }\n            else if (xhr.readyState == 4 && xhr.status == 0) {\n                if(!isValid){ return } ; isValid = false  \n                callback({fail:true})\n\n            }else if (xhr.readyState == 4) {\n                if(!isValid){ return } ; isValid = false  \n                callback({fail:true})\n            }\n        };\n        \n        xhr.open('GET', url, true); \n        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8'); \n        xhr.send();\n        xhr.ontimeout = function () {\n            if(!isValid){ return } ; isValid = false  \n            callback({isTimeout:true})\n        }; \n        retInfo.abort = ()=>{\n            isValid = false\n            xhr.abort()\n        }\n        return retInfo\n    },\n\n    //并行任务 return : {addMis: , onFinish:}  \n    // let pMis = AppComFunc.parallelMis(callback); \n    // pMis.addMis();\n    // pMis.start();\n    // pMis.onFinish\n    parallelMis(callback){\n        let co = 0;\n        let ret = {};\n        co = co+1;\n        let isValid = true\n        let retArgs = {}\n        let onFinish = function(args){\n            if(!isValid){ return }\n            co = co-1;\n            if(args){\n                retArgs = Object.assign(retArgs, args)\n            }\n            if(co<=0){\n                if(callback){\n                    callback(retArgs);\n                }\n            }\n        }\n        ret.onFinish = onFinish;\n        ret.addMis = function(){\n            co = co+1;\n            return onFinish;\n        }\n        ret.start = function(){\n            onFinish();\n        }\n        ret.close = function(){\n            isValid = false\n        }\n        return ret;\n    },\n\n    //顺序任务 idx:0~N,  AppComFunc.sequenceMis(misArr, onAllFolderDetectFinish, (curMis, idx, onExec)=>{ })\n    sequenceMis(misArr, onAllExec, execFunc){\n        cc.log(\"sequenceMis__enter_:\")\n        let co = 0\n        let execMis ;\n        execMis = ()=>{\n            if(co>=misArr.length){\n                onAllExec()\n                return \n            }\n            let mis = misArr[co]\n            let curCo = co\n            co=co+1 \n            execFunc(mis, curCo, execMis)\n        } \n        execMis() \n    },\n\n    // comVersion(localVer, romoteVer)\n    // 对比版本号, -1:本地版本比较旧, 0:相等, 1:本地版本比较新\n    comVersion(localVer, romoteVer){\n        let verSplit_local  = localVer.split('.')\n        let verSplit_remote = romoteVer.split('.')\n        let localCo  = verSplit_local.length\n        let remoteCo = verSplit_remote.length\n        let maxCo = localCo>remoteCo?localCo : remoteCo\n        \n        for(let i=0;i<maxCo;i++){\n            let n_local = parseInt(verSplit_local[i], 10); \n            let n_remote = parseInt(verSplit_remote[i], 10); \n\n            if(i<localCo && i>=remoteCo){ return 1 }\n            else if(i>=localCo && i<remoteCo) { return -1} \n            else if(n_local>n_remote){ return 1}\n            else if(n_local<n_remote){ return -1}\n        }\n        return 0\n    },\n    createUUID(){\n        var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); \n        var uuid = [];  \n        for (let i = 0; i < 4; i++) {\n            uuid[i] = chars[0 | Math.random()*36];\n        }\n        let uid = uuid.join('');\n        uid = Number(Date.now()).toString(36) + uid \n        return uid\n    },\n\n\n}); \n"]}
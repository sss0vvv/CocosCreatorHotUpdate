
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/ModuleMag/UnpackageHelper.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9f4ddWutyZMXK1fvn7MXuH9', 'UnpackageHelper');
// Script/ModuleMag/UnpackageHelper.js

"use strict";

var ModuleConst = require("ModuleConst"); // let UnpackageHelper = require("UnpackageHelper")


var JS_LOG = function JS_LOG() {
  var _cc;

  for (var _len = arguments.length, arg = new Array(_len), _key = 0; _key < _len; _key++) {
    arg[_key] = arguments[_key];
  }

  (_cc = cc).log.apply(_cc, ["[UnpackageHelper]"].concat(arg));
};

cc.Class({
  "extends": cc.Component,
  properties: {},
  onLoad: function onLoad() {
    this._moduleMag = this.getComponent("ModuleManager");
    this._ModuleCom = this.getComponent("ModuleCom");
    this._HotUIHelper = this.getComponent("HotUIHelper");
  },
  initCom: function initCom(args) {// let {  } = args     
  },
  execUnpackage: function execUnpackage(onComplete) {
    var _this = this;

    if (!(cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS || cc.sys.os == cc.sys.OS_WINDOWS)) {
      JS_LOG("ignore_unpackage");
      onComplete();
      return;
    }

    var localClientVer = cc.sys.localStorage.getItem(ModuleConst.localClientVer);
    var writablePath = jsb.fileUtils.getWritablePath();
    var path_cache = writablePath + "gamecaches/";

    if (_Gloabal.Client_Version == localClientVer && jsb.fileUtils.isFileExist(path_cache + "cacheList.json")) {
      JS_LOG("Unpackage_not_exec");
      onComplete();
      return;
    } else {
      // 第一次启动该版本
      var nativeRoot = this._moduleMag.getNativePath(); //  


      var path_native = nativeRoot + "PKgamecaches/";
      JS_LOG("unpackage_res_:", path_native, path_cache);

      if (!jsb.fileUtils.isDirectoryExist(path_native)) {
        JS_LOG("PKgamecaches_not_exist");
        cc.sys.localStorage.setItem(ModuleConst.localClientVer, _Gloabal.Client_Version);
        onComplete();
        return;
      } //-------------------------------------------------->>  替换 cacheManager 数据


      var cacheMag = cc.assetManager.cacheManager; // cacheMag.clearCache()

      var coverCachelist = function coverCachelist() {
        var fileStr = jsb.fileUtils.getStringFromFile(path_native + "cacheList.json");
        var abVersion = {};
        var cache_d_Map = JSON.parse(fileStr);

        if (cache_d_Map) {
          var files = cache_d_Map.files;

          for (var id in files) {
            var info = files[id]; // JS_LOG("call_cacheFile_:", id, info.url, info.bundle )

            cacheMag.cacheFile(id, info.url, info.bundle); // 查找版本号

            if (id.indexOf("/index.") != -1) {
              var splitRet = id.split('.');
              abVersion[info.bundle] = splitRet[splitRet.length - 2];
            }
          }
        } // 覆盖本地资源版本号 


        JS_LOG("abVersion__:", JSON.stringify(abVersion));
        cacheMag.writeCacheFile(function () {
          JS_LOG("writeCache_File_ok");

          _this._moduleMag.setLocalAbVersion(abVersion);

          cc.sys.localStorage.setItem(ModuleConst.localClientVer, _Gloabal.Client_Version);
          onComplete();
        });
      }; //--------------------------------------------------<<  替换 cacheManager 数据


      this._HotUIHelper.unpackageShow();

      this.copyFoldTo(path_native, path_cache, function (finish, total) {
        _this._HotUIHelper.unpackageUpdateProgress(finish, total); // JS_LOG("copy_file_:", finish, total)

      }, function () {
        // 完成 
        _this._HotUIHelper.unpackageFinish();

        coverCachelist();
      });
    }
  },
  getFileListFromDir: function getFileListFromDir(dir, filelist) {
    var co = 1;

    if (cc.sys.os == cc.sys.OS_ANDROID) {
      var cacheJson = jsb.fileUtils.getStringFromFile(dir + "cacheList.json");
      var cacheMap = JSON.parse(cacheJson);
      var files = cacheMap.files;

      for (var url in files) {
        var item = files[url];
        var fullpath = this._moduleMag.getNativePath() + "PKgamecaches/" + item.url;
        filelist.push(fullpath);

        if (co < 3) {
          console.log("get_file_list_full_:", fullpath);
        }

        co = co + 1;
      }
    } else {
      jsb.fileUtils.listFilesRecursively(dir, filelist);
    }
  },
  // 拷贝文件夹到 copyFoldTo("/path1/src/", "/path2/src/") 
  copyFoldTo: function copyFoldTo(oriRoot, copyTo, onProgress, onComplate) {
    var _this2 = this;

    var eachFrameCopyNum = 5; // 每帧复制文件数

    if (typeof jsb == "undefined" || !jsb.fileUtils.isDirectoryExist(oriRoot)) {
      cc.log("ori_folder_not_exist_:", oriRoot);
      onComplate();
      return;
    }

    var filelist = [];
    this.getFileListFromDir(oriRoot, filelist);
    cc.log("file_ori_arr_:", oriRoot, filelist.length);
    var realFileArr = [];

    for (var i = 0; i < filelist.length; i++) {
      var path = filelist[i];

      if (path.substr(path.length - 1) != "/") {
        realFileArr.push(path);
      }
    }

    var totalLen = realFileArr.length;

    if (totalLen == 0) {
      cc.log("totalLen_is_0:", oriRoot);
      onComplate();
      return;
    }

    var curMisIndex = 0;
    var _schHandler = "";

    _schHandler = function schHandler() {
      for (var _i = curMisIndex; _i < curMisIndex + eachFrameCopyNum; _i++) {
        if (_i >= totalLen) {
          _this2.unschedule(_schHandler);

          onComplate();
          return;
        }

        var _path = realFileArr[_i];

        var subPath = _path.substr(oriRoot.length); // 后半部分路径 import/00/00.7871f.json


        var fileName = _path.substr(_path.lastIndexOf("\/") + 1); // 文件名 00.7871f.json


        var targetPath = copyTo + subPath; // 目标完整路径

        var newFold = targetPath.substr(0, targetPath.lastIndexOf("\/") + 1); // 目标文件夹

        if (!jsb.fileUtils.isDirectoryExist(newFold)) {
          // 文件夹不存在则创建 
          jsb.fileUtils.createDirectory(newFold);
        }

        var fileData = jsb.fileUtils.getDataFromFile(_path);
        var saveRet = jsb.fileUtils.writeDataToFile(fileData, targetPath);

        if (!saveRet) {
          _this2.unschedule(_schHandler);

          return;
        }
      }

      curMisIndex = curMisIndex + eachFrameCopyNum;
      onProgress(curMisIndex <= totalLen ? curMisIndex : totalLen, totalLen);
    };

    this.schedule(_schHandler, 0);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvTW9kdWxlTWFnL1VucGFja2FnZUhlbHBlci5qcyJdLCJuYW1lcyI6WyJNb2R1bGVDb25zdCIsInJlcXVpcmUiLCJKU19MT0ciLCJhcmciLCJjYyIsImxvZyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIm9uTG9hZCIsIl9tb2R1bGVNYWciLCJnZXRDb21wb25lbnQiLCJfTW9kdWxlQ29tIiwiX0hvdFVJSGVscGVyIiwiaW5pdENvbSIsImFyZ3MiLCJleGVjVW5wYWNrYWdlIiwib25Db21wbGV0ZSIsInN5cyIsIm9zIiwiT1NfQU5EUk9JRCIsIk9TX0lPUyIsIk9TX1dJTkRPV1MiLCJsb2NhbENsaWVudFZlciIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ3cml0YWJsZVBhdGgiLCJqc2IiLCJmaWxlVXRpbHMiLCJnZXRXcml0YWJsZVBhdGgiLCJwYXRoX2NhY2hlIiwiX0dsb2FiYWwiLCJDbGllbnRfVmVyc2lvbiIsImlzRmlsZUV4aXN0IiwibmF0aXZlUm9vdCIsImdldE5hdGl2ZVBhdGgiLCJwYXRoX25hdGl2ZSIsImlzRGlyZWN0b3J5RXhpc3QiLCJzZXRJdGVtIiwiY2FjaGVNYWciLCJhc3NldE1hbmFnZXIiLCJjYWNoZU1hbmFnZXIiLCJjb3ZlckNhY2hlbGlzdCIsImZpbGVTdHIiLCJnZXRTdHJpbmdGcm9tRmlsZSIsImFiVmVyc2lvbiIsImNhY2hlX2RfTWFwIiwiSlNPTiIsInBhcnNlIiwiZmlsZXMiLCJpZCIsImluZm8iLCJjYWNoZUZpbGUiLCJ1cmwiLCJidW5kbGUiLCJpbmRleE9mIiwic3BsaXRSZXQiLCJzcGxpdCIsImxlbmd0aCIsInN0cmluZ2lmeSIsIndyaXRlQ2FjaGVGaWxlIiwic2V0TG9jYWxBYlZlcnNpb24iLCJ1bnBhY2thZ2VTaG93IiwiY29weUZvbGRUbyIsImZpbmlzaCIsInRvdGFsIiwidW5wYWNrYWdlVXBkYXRlUHJvZ3Jlc3MiLCJ1bnBhY2thZ2VGaW5pc2giLCJnZXRGaWxlTGlzdEZyb21EaXIiLCJkaXIiLCJmaWxlbGlzdCIsImNvIiwiY2FjaGVKc29uIiwiY2FjaGVNYXAiLCJpdGVtIiwiZnVsbHBhdGgiLCJwdXNoIiwiY29uc29sZSIsImxpc3RGaWxlc1JlY3Vyc2l2ZWx5Iiwib3JpUm9vdCIsImNvcHlUbyIsIm9uUHJvZ3Jlc3MiLCJvbkNvbXBsYXRlIiwiZWFjaEZyYW1lQ29weU51bSIsInJlYWxGaWxlQXJyIiwiaSIsInBhdGgiLCJzdWJzdHIiLCJ0b3RhbExlbiIsImN1ck1pc0luZGV4Iiwic2NoSGFuZGxlciIsInVuc2NoZWR1bGUiLCJzdWJQYXRoIiwiZmlsZU5hbWUiLCJsYXN0SW5kZXhPZiIsInRhcmdldFBhdGgiLCJuZXdGb2xkIiwiY3JlYXRlRGlyZWN0b3J5IiwiZmlsZURhdGEiLCJnZXREYXRhRnJvbUZpbGUiLCJzYXZlUmV0Iiwid3JpdGVEYXRhVG9GaWxlIiwic2NoZWR1bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6QixFQUNBOzs7QUFDQSxJQUFJQyxNQUFNLEdBQUcsU0FBVEEsTUFBUyxHQUFnQjtBQUFBOztBQUFBLG9DQUFKQyxHQUFJO0FBQUpBLElBQUFBLEdBQUk7QUFBQTs7QUFDekIsU0FBQUMsRUFBRSxFQUFDQyxHQUFILGFBQU8sbUJBQVAsU0FBOEJGLEdBQTlCO0FBQ0gsQ0FGRDs7QUFJQUMsRUFBRSxDQUFDRSxLQUFILENBQVM7QUFFTCxhQUFTRixFQUFFLENBQUNHLFNBRlA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFLEVBSFA7QUFRTEMsRUFBQUEsTUFSSyxvQkFRRztBQUNKLFNBQUtDLFVBQUwsR0FBa0IsS0FBS0MsWUFBTCxDQUFrQixlQUFsQixDQUFsQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0IsS0FBS0QsWUFBTCxDQUFrQixXQUFsQixDQUFsQjtBQUNBLFNBQUtFLFlBQUwsR0FBb0IsS0FBS0YsWUFBTCxDQUFrQixhQUFsQixDQUFwQjtBQUNILEdB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QUFHTixnQkFBNUI7QUFFQUYsTUFBQUEsVUFBVSxDQUFHUSxXQUFXLElBQUVELFFBQWIsR0FBdUJDLFdBQXZCLEdBQXFDRCxRQUF4QyxFQUFtREEsUUFBbkQsQ0FBVjtBQUVILEtBakNEOztBQWtDQSxTQUFLYyxRQUFMLENBQWNaLFdBQWQsRUFBMEIsQ0FBMUI7QUFFSDtBQXJNSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcblxubGV0IE1vZHVsZUNvbnN0ID0gcmVxdWlyZShcIk1vZHVsZUNvbnN0XCIpXG4vLyBsZXQgVW5wYWNrYWdlSGVscGVyID0gcmVxdWlyZShcIlVucGFja2FnZUhlbHBlclwiKVxubGV0IEpTX0xPRyA9IGZ1bmN0aW9uKC4uLmFyZyl7IFxuICAgIGNjLmxvZyhcIltVbnBhY2thZ2VIZWxwZXJdXCIsLi4uYXJnKSA7IFxufVxuXG5jYy5DbGFzcyh7XG4gICAgXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHsgICBcblxuICAgIH0sXG5cbiAgICBcbiAgICBvbkxvYWQoKXtcbiAgICAgICAgdGhpcy5fbW9kdWxlTWFnID0gdGhpcy5nZXRDb21wb25lbnQoXCJNb2R1bGVNYW5hZ2VyXCIpXG4gICAgICAgIHRoaXMuX01vZHVsZUNvbSA9IHRoaXMuZ2V0Q29tcG9uZW50KFwiTW9kdWxlQ29tXCIpXG4gICAgICAgIHRoaXMuX0hvdFVJSGVscGVyID0gdGhpcy5nZXRDb21wb25lbnQoXCJIb3RVSUhlbHBlclwiKSBcbiAgICB9LFxuXG5cbiAgICBpbml0Q29tKGFyZ3Mpe1xuICAgICAgICAvLyBsZXQgeyAgfSA9IGFyZ3MgICAgIFxuXG4gICAgfSxcblxuICAgIGV4ZWNVbnBhY2thZ2Uob25Db21wbGV0ZSl7XG5cbiAgICAgICAgaWYgKCAhKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCB8fCBjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0lPUyB8fCBjYy5zeXMub3MgPT0gY2Muc3lzLk9TX1dJTkRPV1MpICkge1xuICAgICAgICAgICAgSlNfTE9HKFwiaWdub3JlX3VucGFja2FnZVwiKVxuICAgICAgICAgICAgb25Db21wbGV0ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIFxuICAgICAgICB9IFxuXG4gICAgICAgIGxldCBsb2NhbENsaWVudFZlciA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShNb2R1bGVDb25zdC5sb2NhbENsaWVudFZlcilcbiAgICAgICAgbGV0IHdyaXRhYmxlUGF0aCA9IGpzYi5maWxlVXRpbHMuZ2V0V3JpdGFibGVQYXRoKCkgXG4gICAgICAgIGxldCBwYXRoX2NhY2hlICA9IHdyaXRhYmxlUGF0aCArIFwiZ2FtZWNhY2hlcy9cIiBcbiAgICAgICAgXG4gICAgICAgIGlmKCBfR2xvYWJhbC5DbGllbnRfVmVyc2lvbiA9PSBsb2NhbENsaWVudFZlciAmJiBqc2IuZmlsZVV0aWxzLmlzRmlsZUV4aXN0KHBhdGhfY2FjaGUrXCJjYWNoZUxpc3QuanNvblwiKSl7XG4gICAgICAgICAgICBKU19MT0coXCJVbnBhY2thZ2Vfbm90X2V4ZWNcIilcbiAgICAgICAgICAgIG9uQ29tcGxldGUoKVxuICAgICAgICAgICAgcmV0dXJuIDsgXG5cbiAgICAgICAgfWVsc2UgeyBcbiAgICAgICAgICAgIC8vIOesrOS4gOasoeWQr+WKqOivpeeJiOacrFxuICAgICAgICAgICAgbGV0IG5hdGl2ZVJvb3QgPSB0aGlzLl9tb2R1bGVNYWcuZ2V0TmF0aXZlUGF0aCgpIC8vICBcblxuICAgICAgICAgICAgbGV0IHBhdGhfbmF0aXZlID0gbmF0aXZlUm9vdCArIFwiUEtnYW1lY2FjaGVzL1wiXG4gICAgICAgICAgICBKU19MT0coXCJ1bnBhY2thZ2VfcmVzXzpcIiwgcGF0aF9uYXRpdmUsIHBhdGhfY2FjaGUgKVxuXG4gICAgICAgICAgICBpZighanNiLmZpbGVVdGlscy5pc0RpcmVjdG9yeUV4aXN0KHBhdGhfbmF0aXZlKSl7XG4gICAgICAgICAgICAgICAgSlNfTE9HKFwiUEtnYW1lY2FjaGVzX25vdF9leGlzdFwiKVxuICAgICAgICAgICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShNb2R1bGVDb25zdC5sb2NhbENsaWVudFZlciwgX0dsb2FiYWwuQ2xpZW50X1ZlcnNpb24gKVxuICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKVxuICAgICAgICAgICAgICAgIHJldHVybiA7IFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLT4+ICDmm7/mjaIgY2FjaGVNYW5hZ2VyIOaVsOaNrlxuICAgICAgICAgICAgbGV0IGNhY2hlTWFnID0gY2MuYXNzZXRNYW5hZ2VyLmNhY2hlTWFuYWdlclxuICAgICAgICAgICAgLy8gY2FjaGVNYWcuY2xlYXJDYWNoZSgpXG5cbiAgICAgICAgICAgIGxldCBjb3ZlckNhY2hlbGlzdCA9ICgpPT57XG4gICAgICAgICAgICAgICAgbGV0IGZpbGVTdHIgPSBqc2IuZmlsZVV0aWxzLmdldFN0cmluZ0Zyb21GaWxlKHBhdGhfbmF0aXZlICsgXCJjYWNoZUxpc3QuanNvblwiKSAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbGV0IGFiVmVyc2lvbiA9IHt9IFxuXG4gICAgICAgICAgICAgICAgdmFyIGNhY2hlX2RfTWFwID0gSlNPTi5wYXJzZShmaWxlU3RyKVxuICAgICAgICAgICAgICAgIGlmKGNhY2hlX2RfTWFwKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVzID0gY2FjaGVfZF9NYXAuZmlsZXNcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpZCBpbiAgZmlsZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZm8gPSBmaWxlc1tpZF1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEpTX0xPRyhcImNhbGxfY2FjaGVGaWxlXzpcIiwgaWQsIGluZm8udXJsLCBpbmZvLmJ1bmRsZSApXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWNoZU1hZy5jYWNoZUZpbGUoaWQsIGluZm8udXJsLCBpbmZvLmJ1bmRsZSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5p+l5om+54mI5pys5Y+3XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpZC5pbmRleE9mKFwiL2luZGV4LlwiKSAhPSAtMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNwbGl0UmV0ID0gaWQuc3BsaXQoJy4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFiVmVyc2lvbltpbmZvLmJ1bmRsZV0gPSBzcGxpdFJldFtzcGxpdFJldC5sZW5ndGgtMl1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOimhuebluacrOWcsOi1hOa6kOeJiOacrOWPtyBcbiAgICAgICAgICAgICAgICBKU19MT0coXCJhYlZlcnNpb25fXzpcIiwgSlNPTi5zdHJpbmdpZnkoYWJWZXJzaW9uKSApXG5cbiAgICAgICAgICAgICAgICBjYWNoZU1hZy53cml0ZUNhY2hlRmlsZSgoKT0+e1xuXG4gICAgICAgICAgICAgICAgICAgIEpTX0xPRyhcIndyaXRlQ2FjaGVfRmlsZV9va1wiKVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21vZHVsZU1hZy5zZXRMb2NhbEFiVmVyc2lvbihhYlZlcnNpb24pXG5cblxuICAgICAgICAgICAgICAgICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnNldEl0ZW0oTW9kdWxlQ29uc3QubG9jYWxDbGllbnRWZXIsIF9HbG9hYmFsLkNsaWVudF9WZXJzaW9uIClcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS08PCAg5pu/5o2iIGNhY2hlTWFuYWdlciDmlbDmja5cblxuICAgICAgICAgICAgdGhpcy5fSG90VUlIZWxwZXIudW5wYWNrYWdlU2hvdygpXG4gICAgICAgICAgICB0aGlzLmNvcHlGb2xkVG8ocGF0aF9uYXRpdmUsIHBhdGhfY2FjaGUsIChmaW5pc2gsIHRvdGFsKT0+e1xuICAgICAgICAgICAgICAgIHRoaXMuX0hvdFVJSGVscGVyLnVucGFja2FnZVVwZGF0ZVByb2dyZXNzKGZpbmlzaCwgdG90YWwpXG4gICAgICAgICAgICAgICAgLy8gSlNfTE9HKFwiY29weV9maWxlXzpcIiwgZmluaXNoLCB0b3RhbClcbiAgICAgICAgICAgIH0sKCk9PntcbiAgICAgICAgICAgICAgICAvLyDlrozmiJAgXG4gICAgICAgICAgICAgICAgdGhpcy5fSG90VUlIZWxwZXIudW5wYWNrYWdlRmluaXNoKCkgIFxuICAgICAgICAgICAgICAgIGNvdmVyQ2FjaGVsaXN0KClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuXG4gICAgfSxcblxuXG4gICAgZ2V0RmlsZUxpc3RGcm9tRGlyKGRpciwgZmlsZWxpc3Qpe1xuICAgICAgICBsZXQgY28gPSAxXG4gICAgICAgIGlmKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCl7XG4gICAgICAgICAgICBsZXQgY2FjaGVKc29uID0ganNiLmZpbGVVdGlscy5nZXRTdHJpbmdGcm9tRmlsZShkaXIgKyBcImNhY2hlTGlzdC5qc29uXCIpXG4gICAgICAgICAgICBsZXQgY2FjaGVNYXAgPSBKU09OLnBhcnNlKGNhY2hlSnNvbilcbiAgICAgICAgICAgIGxldCBmaWxlcyA9IGNhY2hlTWFwLmZpbGVzXG4gICAgICAgICAgICBmb3IobGV0IHVybCBpbiBmaWxlcyl7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBmaWxlc1t1cmxdXG4gICAgICAgICAgICAgICAgbGV0IGZ1bGxwYXRoID0gdGhpcy5fbW9kdWxlTWFnLmdldE5hdGl2ZVBhdGgoKStcIlBLZ2FtZWNhY2hlcy9cIitpdGVtLnVybFxuICAgICAgICAgICAgICAgIGZpbGVsaXN0LnB1c2goZnVsbHBhdGgpXG4gICAgICAgICAgICAgICAgaWYoY288Myl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0X2ZpbGVfbGlzdF9mdWxsXzpcIiwgZnVsbHBhdGggKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbyA9IGNvKzFcbiAgICAgICAgICAgIH0gXG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGpzYi5maWxlVXRpbHMubGlzdEZpbGVzUmVjdXJzaXZlbHkoZGlyLCBmaWxlbGlzdClcbiAgICAgICAgfSBcbiAgICB9LFxuXG4gICAgLy8g5ou36LSd5paH5Lu25aS55YiwIGNvcHlGb2xkVG8oXCIvcGF0aDEvc3JjL1wiLCBcIi9wYXRoMi9zcmMvXCIpIFxuICAgIGNvcHlGb2xkVG8ob3JpUm9vdCwgY29weVRvLCBvblByb2dyZXNzLCBvbkNvbXBsYXRlKXtcblxuICAgICAgICBsZXQgZWFjaEZyYW1lQ29weU51bSA9IDUgIC8vIOavj+W4p+WkjeWItuaWh+S7tuaVsFxuXG4gICAgICAgIGlmKCAodHlwZW9mKGpzYik9PVwidW5kZWZpbmVkXCIpIHx8ICFqc2IuZmlsZVV0aWxzLmlzRGlyZWN0b3J5RXhpc3Qob3JpUm9vdCkpe1xuICAgICAgICAgICAgY2MubG9nKFwib3JpX2ZvbGRlcl9ub3RfZXhpc3RfOlwiLCBvcmlSb290IClcbiAgICAgICAgICAgIG9uQ29tcGxhdGUoKTtcbiAgICAgICAgICAgIHJldHVybiBcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmaWxlbGlzdCA9IFtdXG4gICAgICAgIHRoaXMuZ2V0RmlsZUxpc3RGcm9tRGlyKG9yaVJvb3QsIGZpbGVsaXN0KSBcblxuICAgICAgICBjYy5sb2coXCJmaWxlX29yaV9hcnJfOlwiLG9yaVJvb3QsIGZpbGVsaXN0Lmxlbmd0aCk7XG5cbiAgICAgICAgbGV0IHJlYWxGaWxlQXJyID0gW11cbiAgICAgICAgZm9yKGxldCBpPTA7aTxmaWxlbGlzdC5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGxldCBwYXRoID0gZmlsZWxpc3RbaV1cbiAgICAgICAgICAgIGlmKHBhdGguc3Vic3RyKCBwYXRoLmxlbmd0aC0xICkhPVwiL1wiKXtcbiAgICAgICAgICAgICAgICByZWFsRmlsZUFyci5wdXNoKHBhdGgpXG4gICAgICAgICAgICB9IFxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdGFsTGVuID0gcmVhbEZpbGVBcnIubGVuZ3RoXG5cbiAgICAgICAgaWYodG90YWxMZW49PTApe1xuICAgICAgICAgICAgY2MubG9nKFwidG90YWxMZW5faXNfMDpcIiwgb3JpUm9vdCApXG4gICAgICAgICAgICBvbkNvbXBsYXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGN1ck1pc0luZGV4ID0gMFxuXG4gICAgICAgIGxldCBzY2hIYW5kbGVyID0gXCJcIlxuICAgICAgICBzY2hIYW5kbGVyID0gKCk9PntcblxuICAgICAgICAgICAgZm9yKGxldCBpPWN1ck1pc0luZGV4OyBpPGN1ck1pc0luZGV4K2VhY2hGcmFtZUNvcHlOdW07IGkrKyl7IFxuXG4gICAgICAgICAgICAgICAgaWYoaT49dG90YWxMZW4pe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2NoZWR1bGUoc2NoSGFuZGxlcilcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGF0ZSgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBwYXRoID0gcmVhbEZpbGVBcnJbaV0gXG4gICAgXG4gICAgICAgICAgICAgICAgbGV0IHN1YlBhdGggPSBwYXRoLnN1YnN0ciggb3JpUm9vdC5sZW5ndGggKSAgLy8g5ZCO5Y2K6YOo5YiG6Lev5b6EIGltcG9ydC8wMC8wMC43ODcxZi5qc29uXG4gICAgICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gcGF0aC5zdWJzdHIoIHBhdGgubGFzdEluZGV4T2YoXCJcXC9cIikrMSkgLy8g5paH5Lu25ZCNIDAwLjc4NzFmLmpzb25cbiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0UGF0aCA9IGNvcHlUbyArIHN1YlBhdGggLy8g55uu5qCH5a6M5pW06Lev5b6EXG4gICAgICAgICAgICAgICAgbGV0IG5ld0ZvbGQgPSB0YXJnZXRQYXRoLnN1YnN0ciggMCwgdGFyZ2V0UGF0aC5sYXN0SW5kZXhPZihcIlxcL1wiKSsxICkgLy8g55uu5qCH5paH5Lu25aS5XG4gICAgXG4gICAgICAgICAgICAgICAgaWYoIWpzYi5maWxlVXRpbHMuaXNEaXJlY3RvcnlFeGlzdChuZXdGb2xkKSl7IC8vIOaWh+S7tuWkueS4jeWtmOWcqOWImeWIm+W7uiBcbiAgICAgICAgICAgICAgICAgICAganNiLmZpbGVVdGlscy5jcmVhdGVEaXJlY3RvcnkobmV3Rm9sZClcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgZmlsZURhdGEgPSBqc2IuZmlsZVV0aWxzLmdldERhdGFGcm9tRmlsZShwYXRoKTsgXG4gICAgICAgICAgICAgICAgbGV0IHNhdmVSZXQgPSBqc2IuZmlsZVV0aWxzLndyaXRlRGF0YVRvRmlsZShmaWxlRGF0YSwgdGFyZ2V0UGF0aCk7XG4gICAgICAgICAgICAgICAgaWYoIXNhdmVSZXQpe1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5zY2hlZHVsZShzY2hIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgICAgICAgIH0gIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIGN1ck1pc0luZGV4ID0gY3VyTWlzSW5kZXggKyBlYWNoRnJhbWVDb3B5TnVtXG5cbiAgICAgICAgICAgIG9uUHJvZ3Jlc3MoIChjdXJNaXNJbmRleDw9dG90YWxMZW4/IGN1ck1pc0luZGV4IDogdG90YWxMZW4pLCB0b3RhbExlbilcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2NoZWR1bGUoc2NoSGFuZGxlciwgMClcblxuICAgIH0sXG5cbn0pO1xuIl19